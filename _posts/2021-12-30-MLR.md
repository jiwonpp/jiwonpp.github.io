---
published: false
---
(목차)

## Introduction
**Dataset: House Sales in King County, USA, kc_house_data.csv**
https://www.kaggle.com/harlfoxem/housesalesprediction
House sales 데이터는 미국 King County에서 2014년 5월부터 2015년 5월까지 거래된 주택에 대한 정보를 나타냅니다. 각 변수에 대한 설명은 Kaggle 페이지의 Column 항목을 통해 확인할 수 있습니다. 이 중 세 번째 항목인 price가 MLR 모형의 target variable입니다.


## 1. EDA
#### 1-1 모델 구축에 필요하지 않은 변수
Id, date, zipcode 변수는 MLR 모형 구축을 위해 필요하지 않습니다. 
- ID는 서로 다른 집을 식별하는 코드일 뿐 의미가 없습니다. 
- Zipcode는 지역을 구분하는 숫자입니다. 

```r
library(psych) 
library(ggplot2)
library(corrplot)
library(moments)

house <- read.csv("kc_house_data.csv")
head(house)
```

#### 1-2 전처리가 필요한 변수
date는 팔린 날짜 뒤에 T000000이 붙어있어 그대로 사용할 수 없습니다. 
- date변수를 연, 월, 일로 쪼개 house_soldyr, house_soldmnth, house_solddate라는 새로운 변수에 각각 저장했습니다

```r
#Split house sold date into year, month, and date
house_soldyr <- as.numeric(substr(house[,2], 1, 4))
house_soldmnth <- as.numeric(substr(house[,2], 5, 6))
house_solddate <- as.numeric(substr(house[,2], 7, 8))
#Q1. Eliminate useless variable and add sold date
house1 <- cbind(house[,-c(1,2,17)], house_soldyr, house_soldmnth, house_solddate)
```

#### 1-2 입력 변수들의 단변량 통계량과  Boxplot
개별 입력 변수의 단변량 통계량입니다.
```r
#save mean, standard deviation, skewness, kurtosis in df
df <- data.frame(matrix(ncol=5, nrow=0))
colnames(df) <- c("variable", "mean", "sd", "skew", "kurtosis")
for (i in 1:21){
  a <- describe(house1[,i])
  df <- rbind(df,data.frame(variable = colnames(house1[i]),mean = a$mean,sd= a$sd , skew=a$skew ,kurtosis= a$kurtosis))
}
df
```

![descriptive_stats.png]({{site.baseurl}}/_posts/descriptive_stats.png)



#### 1-3 이상치 조건 정의와 제거
위의 Boxplot들을 봤을 때, 가운데 박스에서 점점 멀어질수록 이상치 값이 드물게 나타남을 알 수 있었습니다.
- e.g., Sqft_above변수의 Boxplot에서 90% percentile보다 큰 값들이 꽤 가깝게 몰려 있고, 더 커질수록 이상치가 드물어졌습니다. 

단순히 90% percentile를 초과하는 값을 이상치로 정의하기에는 제거되는 관측치 수가 너무 크다고 생각해 이상치를 [(Q1-3*IQR), (Q3+3*IQR)로 정의했습니다.

이에 해당하는 객체들을 데이터셋에서 제거했습니다. 단, waterfront와 같이 0과 1로 이루어진 binary변수, yr_built처럼 이상치가 존재하지 않는 변수는 이상치를 제거하지 않았습니다. 


```r
#Q3. Remove Outliers
for (i in c(2,3,4,5,11,12,15,16,17,18)){
  house1 <- house1[house1[,i] > quantile(house1[,i], .25) - 3*IQR(house1[,i]) & 
                     house1[,i] < quantile(house1[,i], .75) + 3*IQR(house1[,i]), ] #rows
}
```


#### 1-4 Scatterplot과 Correlation plot
수치형 변수들의 조합에 대해 Scatterplot과 correaltion plot을 그려 변수 간 상관관계를 파악하였습니다.
```r
#Q4. Scatterplot
pairs(house1[c(2,3,4,5,6,9,10,11,12,13,14,15)])

#correlation plot
house_cor <- cor(house1[c(2,3,4,5,6,8,9,10,11,12,13,14,15,16,17,18)], method=c("spearman"))
house_cor
corrplot(house_cor)
```

![scatterplot.png]({{site.baseurl}}/_posts/scatterplot.png)
![correlation plot.png]({{site.baseurl}}/_posts/correlation plot.png)

- 이로부터 sqft_lot15와 sqft_lot의 상관관계가 가장 높음을 알 수 있습니다. Sqft_lot15는 2015년의 lot size고, sqft_lot은 이전 lot size입니다. 리모델링을 하지 않았다면 lot size가 동일할 것이므로 이렇게 상관관계가 높게 나왔다고 생각합니다.
- Sqft_living15와 Sqft_living도 높은 상관관계가 있었습니다. - - Sqft_above와 Sqft_living역시 큰 상관관계가 있었습니다. Sqft_above는 지하를 제외한 집의 size이므로 livingroom size가 크면 sqft_above도 큰 값을 가지게 됩니다. Grade와 sqft_living도 큰 양의 상관관계가 있었습니다. 


#### 전처리
연속형 변수를 factor형 변수로 변형했습니다. 
전체 데이터셋을 70%의 학습 데이터와 30%의 테스트 데이터로 분할했습니다.

```r
##Continuous variables to factor variables 
house1$house_soldyr <- as.factor(house1$house_soldyr)
house1$house_soldyr
house1$house_soldmnth <- as.factor(house1$house_soldmnth)
house1$house_solddate <- as.factor(house1$house_solddate)
house1$waterfront <- as.factor(house1$waterfront)

#Split the data into the training/validation sets
nHome <- nrow(house1)
nVar <- ncol(house1)
house_trn_idx <- sample(1:nHome, round(0.7*nHome))
house_trn_data <- house1[house_trn_idx,]
house_val_data <- house1[-house_trn_idx,]


## Modeling
모든 변수를 사용하여 


결과는 다음과 같습니다.

![Picture3.jpg]({{site.baseurl}}/_posts/Picture3.jpg)

Adjusted R2값은 0.6949였습니다. 이는 데이터가 비교적 선형성을 띄고 있고, 모델 구축에 사용한 변수들로 전체 변동의 69%를 설명할 수 있음을 나타냅니다. 








